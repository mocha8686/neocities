---
import { Font } from 'astro:assets';

import Back from '$src/components/Back.astro';

import BaseLayout from './BaseLayout.astro';
---

<BaseLayout>
	<Fragment slot="head">
		<Font cssVariable="--font-rajdhani" preload />
		<Font cssVariable="--font-kode-mono" preload />
	</Fragment>

	<slot />
	<Back />
</BaseLayout>

<style is:global>
	:root {
		/* stylelint-disable custom-property-empty-line-before */
		--cl-light: oklch(89% 0.13 201);
		--cl-dark: oklch(0% 0 0);
		--cl-accent: oklch(67% 0.2 27);

		--cl-outline: oklch(38% 0.1 24);
		--cl-container: oklch(38% 0.1 24 / 0.4);

		--ff-main: var(--font-rajdhani);
		--ff-accent: var(--font-rajdhani);
		--ff-code: var(--font-kode-mono);

		--astro-code-foreground: oklch(
			from var(--cl-foreground) calc(l * 0.8) calc(c * 0.7) h
		);
		--astro-code-background: var(--cl-background);

		--astro-code-token-parameter: var(--cl-foreground);
		--astro-code-token-string: var(--cl-foreground);
		--astro-code-token-string-expression: var(--astro-code-token-string);

		--astro-code-token-punctuation: var(--astro-code-foreground);

		--astro-code-token-link: var(--cl-accent);
		--astro-code-token-function: var(--cl-accent);

		--astro-code-token-comment: oklch(76% 0.19 153);
		--astro-code-token-keyword: oklch(86% 0.21 131);
		--astro-code-token-constant: oklch(92% 0.19 91);
		/* stylelint-enable custom-property-empty-line-before */

		color-scheme: only dark;

		interpolate-size: allow-keywords;
	}

	body {
		margin-block-end: 2rem;
		margin-inline: 1rem;

		font-family: var(--ff-main);
		color: var(--cl-foreground);

		background: var(--cl-background);
	}

	:where(h1, h2, h3, h4, h5, h6) {
		font-family: var(--ff-accent);
		text-transform: uppercase;
	}

	a {
		color: var(--cl-accent);
	}

	hr {
		margin-block: 2rem;
		border-color: var(--cl-accent);
	}

	h1::before {
		content: '$ ';
	}

	h1::after {
		content: '|';
		animation: 1.5s cubic-bezier(0, 1, 0, 1) infinite forwards blink;

		@media (prefers-reduced-motion: reduce) {
			animation: none;
		}
	}

	@keyframes blink {
		50% {
			opacity: 0;
		}
	}

	h1 {
		font-family: var(--ff-code);
		color: var(--cl-accent);
	}

	code,
	kbd,
	samp {
		font-family: var(--ff-code);
		font-size: 1.1rem;
		color: var(--cl-accent);
	}

	p {
		font-size: 1.15rem;
		text-wrap: pretty;
	}

	code,
	kbd,
	samp,
	a,
	h1 {
		--radius: 18px;

		text-shadow:
			0 0 var(--radius) var(--cl-accent),
			0 0 var(--radius) var(--cl-accent);
	}

	.astro-code {
		padding: 0.5em 2ch;
		background-color: var(--cl-container) !important;

		code,
		kbd,
		samp {
			font-size: 1rem;
			color: inherit;
			text-shadow: none;
		}
	}

	.astro-code,
	.astro-code span {
		font-family: var(--ff-code);
	}

	pre.astro-code {
		counter-reset: code-line;
	}

	.astro-code:not([data-language='plaintext']) .line {
		&::before {
			content: counter(code-line);
			counter-increment: code-line;
			margin-inline-end: 2ch;
			opacity: 0.5;
		}

		&:nth-child(-n + 9)::before {
			content: ' ' counter(code-line);
		}
	}

	.astro-code[data-language='plaintext'] {
		line-height: 1.1;
	}
</style>
