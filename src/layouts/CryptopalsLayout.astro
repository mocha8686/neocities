---
import { Font } from 'astro:assets';
import { getImage } from 'astro:assets';

import right from '$src/assets/icons/arrow-right.svg';
import Back from '$src/components/Back.astro';

import BaseLayout from './BaseLayout.astro';

const arrow = await getImage({ src: right });
---

<BaseLayout style={`--arrow: url("${arrow.src}")`}>
	<Fragment slot="head">
		<Font cssVariable="--font-rajdhani" preload />
		<Font cssVariable="--font-kode-mono" preload />
	</Fragment>

	<slot />

	<Back />
</BaseLayout>

<style is:global>
	:root {
		/* stylelint-disable custom-property-empty-line-before */
		--cl-light: oklch(89% 0.13 201);
		--cl-dark: oklch(0% 0 0);
		--cl-accent: oklch(67% 0.2 27);

		--cl-outline: oklch(38% 0.1 24);
		--cl-container: oklch(38% 0.1 24 / 0.4);

		--ff-main: var(--font-rajdhani);
		--ff-accent: var(--font-rajdhani);
		--ff-code: var(--font-kode-mono);

		--cl-yellow: oklch(92% 0.19 91);
		--cl-green: oklch(86% 0.21 131);
		--cl-teal: oklch(76% 0.19 153);

		--astro-code-foreground: oklch(
			from var(--cl-foreground) calc(l * 0.8) calc(c * 0.7) h
		);
		--astro-code-background: var(--cl-background);

		--astro-code-token-string: var(--cl-yellow);
		--astro-code-token-string-expression: var(--astro-code-token-string);

		--astro-code-token-parameter: var(--cl-yellow);

		--astro-code-token-punctuation: var(--cl-green);
		--astro-code-token-constant: var(--cl-green);

		--astro-code-token-link: var(--cl-accent);
		--astro-code-token-function: var(--cl-accent);

		--astro-code-token-comment: var(--cl-teal);
		--astro-code-token-keyword: var(--cl-foreground);
		/* stylelint-enable custom-property-empty-line-before */

		color-scheme: only dark;

		interpolate-size: allow-keywords;
	}

	body {
		margin-block-end: 2rem;
		margin-inline: 1rem;

		font-family: var(--ff-main);
		color: var(--cl-foreground);

		background: var(--cl-background);
	}

	:where(h1, h2, h3, h4, h5, h6) {
		font-family: var(--ff-accent);
		color: var(--cl-accent);
		text-transform: uppercase;
	}

	a {
		color: var(--cl-accent);
	}

	hr {
		margin-block: 2rem;
		border-color: var(--cl-outline);
	}

	h1::before {
		content: '$ ';
	}

	h1::after {
		content: '|';

		display: inline-block;

		font-size: 1.5em;
		vertical-align: middle;

		animation: 1.5s cubic-bezier(0, 1, 0, 1) infinite forwards blink;

		@media (prefers-reduced-motion: reduce) {
			animation: none;
		}
	}

	h1 {
		font-size: 3rem;
	}

	h2 {
		font-size: 2rem;
	}

	h3 {
		font-size: 1.8rem;
	}

	h4 {
		font-size: 1.5rem;
	}

	@keyframes blink {
		50% {
			opacity: 0;
		}
	}

	h1 {
		font-family: var(--ff-accent);
		color: var(--cl-accent);
	}

	code,
	kbd,
	samp {
		font-family: var(--ff-code);
		font-size: 1.1rem;
		color: var(--cl-accent);
	}

	p {
		font-size: 1.15rem;
		text-wrap: pretty;
	}

	code,
	kbd,
	samp,
	a,
	h1 {
		--radius: 18px;

		text-shadow:
			0 0 var(--radius) var(--cl-accent),
			0 0 var(--radius) var(--cl-accent);
	}

	.astro-code {
		--border-color: var(--cl-accent);
		--border-width: 2px;
		--bar-width: 8px;
		--bevel-size: 32px;
		--background-color: var(--cl-container);

		--bevel-start: calc(
			(var(--bevel-size) - var(--border-width)) * sqrt(2) / 2
		);
		--bevel-end: calc(var(--bevel-start) + var(--border-width));

		position: relative;

		margin-block: 2rem;
		padding: 0.5em 2ch;
		border: var(--border-width) solid transparent;
		border-inline-start-width: var(--bar-width);

		background:
			top left / 100% var(--border-width)
				linear-gradient(180deg, var(--border-color), var(--border-color))
				border-box,
			top left / var(--bar-width) 100%
				linear-gradient(180deg, var(--border-color), var(--border-color))
				border-box,
			bottom left / calc(100% - var(--bevel-size)) var(--border-width)
				linear-gradient(0deg, var(--border-color), var(--border-color))
				border-box,
			top right / var(--border-width) calc(100% - var(--bevel-size))
				linear-gradient(90deg, var(--border-color), var(--border-color))
				border-box,
			bottom right / var(--bevel-size) var(--bevel-size)
				linear-gradient(
					135deg,
					transparent var(--bevel-start),
					var(--border-color) var(--bevel-start),
					var(--border-color) var(--bevel-end),
					var(--cl-background) var(--bevel-end)
				)
				border-box,
			transparent;
		background-color: var(--cl-container) !important;
		background-repeat: no-repeat;

		code,
		kbd,
		samp {
			font-size: 1rem;
			color: inherit;
			text-shadow: none;
		}
	}

	.astro-code,
	.astro-code span {
		font-family: var(--ff-code);
	}

	pre.astro-code {
		counter-reset: code-line;
	}

	.astro-code:not([data-language='plaintext']) .line {
		&::before {
			content: counter(code-line);
			counter-increment: code-line;
			margin-inline-end: 2ch;
			opacity: 0.5;
		}

		&:nth-child(-n + 9)::before {
			content: ' ' counter(code-line);
		}
	}

	.astro-code[data-language='plaintext'] {
		line-height: 1.1;
	}

	details {
		--transition-duration: 150ms;
		--size: 24px;

		&::details-content {
			overflow-y: clip;
			display: block;
			height: 0;
			transition:
				height var(--transition-duration) ease-out,
				content-visibility var(--transition-duration) allow-discrete;
		}

		> summary {
			display: block;

			&::before {
				content: '';

				display: inline-block;

				aspect-ratio: 1;
				width: var(--size);

				color: var(--cl-accent);
				vertical-align: middle;

				background-color: currentColor;

				transition: rotate var(--transition-duration) ease-out;

				mask-image: var(--arrow);
				mask-repeat: no-repeat;
				mask-size: 100% 100%;
			}
		}
	}

	details[open] {
		&::details-content {
			height: auto;
		}

		> summary::before {
			rotate: 90deg;
		}
	}
</style>
